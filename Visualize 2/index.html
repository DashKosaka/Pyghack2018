<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Student Class Heatmap</title>
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 90%;
        }

        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .slidecontainer {
            width: 50%;
            padding: 2%;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #5cf958;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        p.round2 {
            border: 2px solid red;
            border-radius: 8px;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>


    var citymap;
    var drawn = false;

    function loadFile(filename) {
        myPromise = asyncGetFile(filename);

        myPromise.then((retrievedText) => {
            citymap = JSON.parse(retrievedText);
            console.log("File retrieved");
            console.log(citymap);

        })
            .catch(
                (reason) => {
                    console.log('handle rejected promise (' + reason + ') here.')
                });

    }


    function asyncGetFile(url) {
        console.log("Getting text file");
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            xhr.open("Get", url);
            xhr.onload = () => resolve(xhr.responseText);
            xhr.onerror = () => reject(xhr.statusText);
            xhr.send();
            console.log("Made promise");
        });

    }

    function initMap() {
        // Create the map.

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 17,
            center: {lat: 40.107472, lng: -88.227236},
            mapTypeId: 'terrain'
        });

        // Construct the circle for each value in citymap.
        // Note: We scale the area of the circle based on the population.
        for (var city in citymap) {
            console.log(city);
            // Add the circle for this city to the map.
            var cityCircle = new google.maps.Circle({
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.35,
                map: map,
                center: citymap[city].center,
                radius: Math.sqrt(citymap[city].population) * 5
            });
        }
        drawn = true;

    }

    function startup() {
        loadFile("data.json");
        tick();

    }

    function tick() {
        requestAnimFrame(tick);
        if (citymap && !drawn)
            initMap();

    }
</script>
<script src="webgl-utils.js"></script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVnvwBcCllCfpVXnHh6OPiga3MiLcswGo&callback=startup">
</script>
<p class="slidecontainer">
    <input type="range" min="0" max="1439" value="50" class="slider" id="myRange">
<p>Value: <span id="demo"></span></p>
</p>
<script>
    var slider = document.getElementById("myRange");
    var output = document.getElementById("demo");
    output.innerHTML = convert_minutes_to_std_time(slider.value);

    function convert_minutes_to_std_time(time_num) {
        var meridian;
        if (time_num >= 720) {
            meridian = "PM";
        } else {
            meridian = "AM";
        }
        time_num = time_num%720
        var hours = Math.floor(time_num / 60);
        if (hours == 0) { // <--- WTF IS THIS CODE
            hours = 12;
        }
        var minutes = ("0" + (time_num % 60)).slice(-2);
        return "" + hours + ":" + minutes + meridian;
    }

    slider.oninput = function () {
        output.innerHTML = convert_minutes_to_std_time(slider.value);
    }
</script>

</body>
</html>