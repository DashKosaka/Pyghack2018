<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Student Class Heatmap</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #root {
        height: 90%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
    <script>


        var citymap;
        var drawn = false;
        function loadFile(filename) {
            myPromise = asyncGetFile(filename);

            myPromise.then((retrievedText) => {
                citymap = JSON.parse(retrievedText);
                console.log("File retrieved");
                console.log(citymap);

            })
                .catch(
                    (reason) => {
                        console.log('handle rejected promise ('+reason+') here.')
                    });

        }


        function asyncGetFile(url) {
            console.log("Getting text file");
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open("Get", url);
                xhr.onload = () => resolve(xhr.responseText);
                xhr.onerror = () => reject(xhr.statusText);
                xhr.send();
                console.log("Made promise");
            });

        }

        function initMap() {
            // Create the map.

            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 17,
                center: { lat: 40.107472, lng: -88.227236 },
                mapTypeId: 'terrain'
            });

            // Construct the circle for each value in citymap.
            // Note: We scale the area of the circle based on the population.
            for (var city in citymap) {
                console.log(city);
                // Add the circle for this city to the map.
                var cityCircle = new google.maps.Circle({
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                    map: map,
                    center: citymap[city].center,
                    radius: Math.sqrt(citymap[city].population) * 5
                });
            }
            drawn = true;

        }
        function startup() {
            loadFile("data.json");
            tick();

        }
        function tick() {
            requestAnimFrame(tick);
            if(citymap && !drawn)
                initMap();

        }
    </script>
    <script src="webgl-utils.js"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVnvwBcCllCfpVXnHh6OPiga3MiLcswGo&callback=startup">
    </script>
  </body>
</html>
